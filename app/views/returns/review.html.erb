<div id="header">
	<ul id="links-top">
		<li class="active link-one"><a class="button"><span class="number">1</span> Choose Items to Return</a></li>
		<li class=" active link-two content-before"><span class="number">2</span> Review and Confirm</li>
		<li class="link-three content-before content-after"><span class="number">3</span> Print Shipping Label</li>
	</ul>
</div>
<div id="main-container">
	
	<div id="review-content">
		<% if (@all_errors.length>1) %>
			<div class="red"><%= @all_errors %></div>
		<% end %>
		
		

		<%= form_tag({controller:"returns", action: "final_step"},method: "post",id: "review-form") do %>
			<input type="hidden" name="order_id" value="<%= @order[:id] %>" />
			<input type="hidden" name="order_num" value="<%= @order[:order_num] %>" />

			
			<% @order_items.each do |item| %>
			
			<% (1..@counts[item[:id].to_s]).to_a.each do |times| %>
			<div class="product-container">
			<div class="product-sidebar">
				<div class="product-sidebar-wrapper">
					<input type="hidden" name="order_items[]" value="<%= item[:id]%>" />

					<img width="260" height="390" src="<%= image_url("image.jpg") %>" />
					<div class="order-item-desc">
						<p><b><%= item.product_name %></b></p>
						<p>Refund: <%= number_to_currency(item[:price]) %></p>
						<p>To card ending in 5002</p>
					</div>
				</div>
			</div>
			<div class="product-content">
				<h2>Reason for returning this item:</h2>
				<span>Please select all that apply. Your answers help us improve our products.</span>
				<ul class="options">
				<% @options.each do |obj| %>
				<li>
					<% if(obj[:attr_type]==1) %>
					<b><%= obj[:attr_name] %></b>
					<% else %>
					<input type="checkbox" name="return_attributes[<%= item[:id]%>][<%= times %>][]" value="<%= obj[:id] %>" /><%= obj[:attr_name] %>
					<% end %>
					
					<% if(obj.child_attributes.any?) %>
						<ul class="sub-options">
							<% obj.child_attributes.each do |cobj| %>
								<li><input type="checkbox" name="return_attributes[<%= item[:id]%>][<%= times %>][]" value="<%= cobj[:id] %>" /><%= cobj[:attr_name] %></li>
							<% end %>
						</ul>	
					<% end %>
				</li>
				<% end %>
				</ul>
			</div>
			</div>
			<% end %>
			
			<% end %>

			<div id="footer">
			<a href="#" class='previous-options'>Previous Options</a>
			<button type="submit" disabled="disabled" class="next-btn">Continue to next step</button></div>
		<% end %>
	</div>
</div>

<%= form_tag({controller:"returns", action: "order_num"},method: "post",id: "step-one-form") do %>
<input type="hidden" name="order_num" value="<%= @order[:order_num] %>" />
<% end %>


<script type="text/javascript">
	$("#review-form").on("change","input[type='checkbox']",function(e) {
		if($(this).closest("ul.sub-options").length) {

			if($(this).closest("ul.sub-options").find("input[type='checkbox']:checked").length) {
				$(this).closest("ul.sub-options").prev("ul li").prop("checked",true);
			}
		}
		console.log($("#items-form").find("input[type='checkbox']:checked"));
		if($("#review-form").find("input[type='checkbox']:checked").length) {
			$("#review-form button").prop("disabled",false);
		}
		else {
			$("#review-form button").prop("disabled",true);
		}
		//if($(this).find("input["))
	});

	$("a.previous-options").on("click",function(e) {
		e.preventDefault();
		if($("#step-one-form").length) {
			$("#step-one-form").submit();
		}
	});
</script>




